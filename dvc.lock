schema: '2.0'
stages:
  harmonize_eo_data:
    cmd: python src/data/harmonize_eo_data.py -n 12
    deps:
    - path: src/data/harmonize_eo_data.py
      hash: md5
      md5: 0e3caf7e63c91a0ae189efd807abee3b
      size: 7183
    params:
      params.yaml:
        base_resolution: 0.01
        datasets.X:
          canopy_height: ETH_GlobalCanopyHeight_2020_v1_1km
          modis: modis_sur_refl_monthly_avg_1km
          soilgrids: soilgrids_v2-0_1km
          vodca: vodca_mean-p5-p95_1km
          worldclim: wc2-1_30s_bio
        eo_data.interim.dir: eo_data
        mask:
          path: data/raw/esa_worldcover_v100_1km/esa_worldcover_v100_1km.tif
          keep_classes:
          - 10
          - 20
          - 30
          - 40
          - 60
          - 70
          - 90
          - 95
          - 100
        model_res: '001'
        target_resolution: 0.01
        worldclim.bio_vars:
        - '1'
        - '4'
        - '7'
        - '12'
        - 13-14
        - '15'
    outs:
    - path: data/interim/eo_data/001
      hash: md5
      md5: 33b4751370ba70d27e0b170fa13beb54.dir
      size: 34856945252
      nfiles: 150
  build_predict:
    cmd: python src/features/featurize_predict.py
    deps:
    - path: data/interim/eo_data/001
      hash: md5
      md5: 33b4751370ba70d27e0b170fa13beb54.dir
      size: 34856945252
      nfiles: 150
    - path: src/features/featurize_predict.py
      hash: md5
      md5: baf07e318781b89bdf67a8ef22992f17
      size: 4432
    params:
      params.yaml:
        eo_data.interim.dir: eo_data
        eo_data.predict.dir: predict
        eo_data.predict.imputed_fn: eo_predict_imputed.parquet
        eo_data.predict.mask_fn: eo_predict_mask.parquet
        model_res: '001'
        train.dir: data/features
    outs:
    - path: data/features/predict/001/eo_predict_imputed.parquet
      hash: md5
      md5: 0d865c4fb80cfb31a2dca600ee87896f
      size: 32491512883
    - path: data/features/predict/001/eo_predict_mask.parquet
      hash: md5
      md5: ccb875cc5b91fa8167876a9e075a3b47
      size: 605125575
  standardize_other_products:
    cmd: python src/data/standardize_other_products.py
    deps:
    - path: data/raw/other-trait-maps
      hash: md5
      md5: 224244cf76242106abf656a1946fb350.dir
      size: 28945584053
      nfiles: 1506
    - path: src/data/standardize_other_products.py
      hash: md5
      md5: f0e35e20db15f9c3e94e2e5ee91fec17
      size: 2539
    outs:
    - path: data/interim/other_trait_maps
      hash: md5
      md5: fe0cdb6c19dc0bac2da8766b15c630b7.dir
      size: 499888340
      nfiles: 44
  get_TRY_mean_traits:
    cmd: python src/data/build_try_traits.py
    deps:
    - path: data/raw/TRY_6_gapfilled_for_distribution/TRY6_gapfilled_for_distribution.zip
      hash: md5
      md5: f2cc4a7dd419bed117f42e62780b16e8
      size: 307941318
    - path: src/data/build_try_traits.py
      hash: md5
      md5: 2e3f44bf4e467e6da01e73daf0d1afd1
      size: 3432
    params:
      params.yaml:
        trydb:
          raw:
            dir: TRY_6_gapfilled_for_distribution
            zip: TRY6_gapfilled_for_distribution.zip
            zipfile_csv: TRY6_gapfilled_for_distribution/TRY6_gapfilled_filtered_2.csv.zip
            already_norm:
            - 13
            - 47
            - 95
            - 78
            - 4
            pfts: try_pft_v2.parquet
          interim:
            dir: try
            quantile_range:
            filtered: traits.parquet
    outs:
    - path: data/interim/try/traits.parquet
      hash: md5
      md5: 546b4d12b8c75663f4e07d2a47ad828e
      size: 18025426
